!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.AvailabilityCalendar=e()}("undefined"!=typeof self?self:this,function(){"use strict";const t=t=>String(t).padStart(2,"0"),e=e=>`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())}`,s=t=>new Date(t.replace(" ","T")),a=t=>new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),n=(t,e)=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate();function o(t,e){const a=s(t.start),n=s(t.stop),o={hour:"2-digit",minute:"2-digit"};return`${a.toLocaleTimeString(e,o)} – ${n.toLocaleTimeString(e,o)}`}return class{constructor(t,e={}){if(this.el="string"==typeof t?document.querySelector(t):t,!this.el)throw new Error("AvailabilityCalendar: container not found");this.opts={data:e.data||null,maxDays:Number.isFinite(e.maxDays)?e.maxDays:30,locale:e.locale||"es-ES",weekStartsOn:Number.isFinite(e.weekStartsOn)?e.weekStartsOn:1,hideMonthNav:!!e.hideMonthNav,onSlotSelect:"function"==typeof e.onSlotSelect?e.onSlotSelect:null},this._today=a(new Date),this._rangeStart=this._today,this._rangeEnd=a(((t,e)=>{const s=new Date(t);return s.setDate(s.getDate()+e),s})(this._today,this.opts.maxDays)),this._currentMonth=new Date(this._today.getFullYear(),this._today.getMonth(),1),this._selectedDateKey=null,this._selectedSlotStart=null,this._dataMap=new Map,this._boundPrev=()=>this.prevMonth(),this._boundNext=()=>this.nextMonth(),this._build(),this.setData(this.opts.data),this.render()}destroy(){this._root?.querySelector(".ac__prev")?.removeEventListener("click",this._boundPrev),this._root?.querySelector(".ac__next")?.removeEventListener("click",this._boundNext),this.el.innerHTML="",this._dataMap.clear()}setData(t){this._dataMap.clear(),this.opts.data=t||null;const e=t?.days||[];for(const t of e)t?.date&&this._dataMap.set(t.date,Array.isArray(t.slots)?t.slots:[]);if(!this._selectedDateKey){const t=e.find(t=>t?.date&&(t?.slots?.length||0)>0);t?.date&&(this._selectedDateKey=t.date)}if(this._selectedSlotStart){(this._dataMap.get(this._selectedDateKey)||[]).some(t=>t.start===this._selectedSlotStart)||(this._selectedSlotStart=null)}}render(){this._renderHeader(),this._renderGrid(),this._renderSlotsPanel(),this._updateNavButtons()}prevMonth(){const t=new Date(this._currentMonth);t.setMonth(t.getMonth()-1),this._monthEnd(t)<this._rangeStart||(this._currentMonth=t,this.render())}nextMonth(){const t=new Date(this._currentMonth);t.setMonth(t.getMonth()+1),this._monthStart(t)>this._rangeEnd||(this._currentMonth=t,this.render())}_build(){this.el.innerHTML="",this._root=document.createElement("div"),this._root.className="ac",this._root.innerHTML=`\n          <div class="ac__header">\n            <div class="ac__title"></div>\n            <div class="ac__nav" ${this.opts.hideMonthNav?'style="display:none"':""}>\n              <button type="button" class="ac__btn ac__prev" aria-label="Mes anterior">‹</button>\n              <button type="button" class="ac__btn ac__next" aria-label="Mes siguiente">›</button>\n            </div>\n          </div>\n  \n          <div class="ac__grid">\n            <div class="ac__weekdays"></div>\n            <div class="ac__days"></div>\n          </div>\n  \n          <div class="ac__slots">\n            <div class="ac__slotsTitle">\n              <span class="ac__slotsLabel">Horarios</span>\n              <span class="ac__slotsDate"></span>\n            </div>\n            <div class="ac__slotsList"></div>\n            <div class="ac__empty" style="display:none;"></div>\n          </div>\n        `,this.el.appendChild(this._root),this._root.querySelector(".ac__prev").addEventListener("click",this._boundPrev),this._root.querySelector(".ac__next").addEventListener("click",this._boundNext);const t=this._root.querySelector(".ac__weekdays"),e=this._weekdayNames(this.opts.locale,this.opts.weekStartsOn);t.innerHTML=e.map(t=>`<div>${t}</div>`).join("")}_renderHeader(){var t,e,s;this._root.querySelector(".ac__title").textContent=(e=this._currentMonth,s=this.opts.locale,(t=e.toLocaleDateString(s,{month:"long",year:"numeric"}))?t.charAt(0).toUpperCase()+t.slice(1):t)}_renderGrid(){const t=this._root.querySelector(".ac__days");t.innerHTML="";const s=this._monthStart(this._currentMonth),a=this._monthEnd(this._currentMonth),o=this._startOfWeek(s,this.opts.weekStartsOn),i=this._endOfWeek(a,this.opts.weekStartsOn);let r=new Date(o);for(;r<=i;){const s=r.getMonth()===this._currentMonth.getMonth(),a=e(r),o=r<this._rangeStart||r>this._rangeEnd,i=this._dataMap.get(a)||[],l=i.length>0,d=document.createElement("div");d.className="ac__day",s||d.classList.add("ac__day--muted"),o&&d.classList.add("ac__day--disabled"),n(r,this._today)&&d.classList.add("ac__day--today"),l&&!o&&d.classList.add("ac__day--available"),this._selectedDateKey===a&&d.classList.add("ac__day--selected"),d.innerHTML=`\n            <div class="ac__dayNum">${r.getDate()}</div>\n            ${l&&!o?`<div class="ac__badge">${i.length}</div>`:"<div></div>"}\n          `,o||d.addEventListener("click",()=>{this._selectedDateKey=a,this._selectedSlotStart=null,r.getMonth()!==this._currentMonth.getMonth()&&(this._currentMonth=new Date(r.getFullYear(),r.getMonth(),1)),this.render()}),t.appendChild(d),r.setDate(r.getDate()+1)}}_renderSlotsPanel(){const t=this._root.querySelector(".ac__slotsDate"),s=this._root.querySelector(".ac__slotsList"),a=this._root.querySelector(".ac__empty");s.innerHTML="",a.style.display="none";const n=this._selectedDateKey||e(this._today),i=this._dataMap.get(n)||[];if(t.textContent=n,!i.length)return a.textContent="No hay horarios disponibles para este día.",void(a.style.display="block");for(const t of i){const e=document.createElement("button");e.type="button",e.className="ac__slotBtn",e.textContent=o(t,this.opts.locale),t.start===this._selectedSlotStart&&e.classList.add("ac__slotBtn--selected"),e.addEventListener("click",()=>{this._selectedSlotStart=t.start,this._renderSlotsPanel(),this.opts.onSlotSelect&&this.opts.onSlotSelect({date:n,slot:t})}),s.appendChild(e)}}_updateNavButtons(){if(this.opts.hideMonthNav)return;const t=this._root.querySelector(".ac__prev"),e=this._root.querySelector(".ac__next"),s=new Date(this._currentMonth);s.setMonth(s.getMonth()-1);const a=new Date(this._currentMonth);a.setMonth(a.getMonth()+1),t.disabled=this._monthEnd(s)<this._rangeStart,e.disabled=this._monthStart(a)>this._rangeEnd}_weekdayNames(t,e){const s=new Date(2023,0,1),a=[];for(let n=0;n<7;n++){const o=new Date(s);o.setDate(s.getDate()+(e+n)%7),a.push(o.toLocaleDateString(t,{weekday:"short"}).replace(".",""))}return a}_startOfWeek(t,e){const s=a(t),n=(s.getDay()-e+7)%7;return s.setDate(s.getDate()-n),s}_endOfWeek(t,e){const s=a(t),n=s.getDay();return s.setDate(s.getDate()+(6-(n-e+7)%7)),s}_monthStart(t){return new Date(t.getFullYear(),t.getMonth(),1,0,0,0,0)}_monthEnd(t){return new Date(t.getFullYear(),t.getMonth()+1,0,23,59,59,999)}}});